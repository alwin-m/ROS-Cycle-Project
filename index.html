<!--
MITãƒ©ã‚¤ã‚»ãƒ³ã‚¹

è‘—ä½œæ¨© (c) 2025 Alwin

æœ¬ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãŠã‚ˆã³é–¢é€£ã™ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆä»¥ä¸‹ã€Œã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã€ï¼‰ã®ã‚³ãƒ”ãƒ¼ã‚’å–å¾—ã—ãŸã™ã¹ã¦ã®è€…ã«ã€ä»¥ä¸‹ã«å®šã‚ã‚‹æ¡ä»¶ã«å¾“ã„ã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’åˆ¶é™ãªãä½¿ç”¨ã€ã‚³ãƒ”ãƒ¼ã€æ”¹å¤‰ã€çµåˆã€å…¬é–‹ã€é…å¸ƒã€ã‚µãƒ–ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã€ãŠã‚ˆã³/ã¾ãŸã¯è²©å£²ã™ã‚‹æ¨©åˆ©ã‚’å«ã‚€ãŒã“ã‚Œã«é™å®šã•ã‚Œãªã„æ¨©åˆ©ã‚’ç„¡å„Ÿã§ä»˜ä¸ã—ã¾ã™ã€‚

ä¸Šè¨˜ã®è‘—ä½œæ¨©è¡¨ç¤ºãŠã‚ˆã³ã“ã®è¨±å¯é€šçŸ¥ã¯ã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ã™ã¹ã¦ã®ã‚³ãƒ”ãƒ¼ã¾ãŸã¯å®Ÿè³ªçš„ãªéƒ¨åˆ†ã«å«ã¾ã‚Œã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚

ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã¯ã€Œç¾çŠ¶ã®ã¾ã¾ã€æä¾›ã•ã‚Œã€å•†å“æ€§ã€ç‰¹å®šã®ç›®çš„ã¸ã®é©åˆæ€§ã€éä¾µå®³ã‚’å«ã‚€ãŒã“ã‚Œã«é™å®šã•ã‚Œãªã„ã€æ˜ç¤ºã¾ãŸã¯é»™ç¤ºã®ã„ã‹ãªã‚‹ä¿è¨¼ã‚‚ã‚ã‚Šã¾ã›ã‚“ã€‚è‘—ä½œè€…ã¾ãŸã¯è‘—ä½œæ¨©è€…ã¯ã€å¥‘ç´„ã€ä¸æ³•è¡Œç‚ºã€ã¾ãŸã¯ãã®ä»–ã®è¡Œç‚ºã«é–¢ã‚ã‚‰ãšã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã¾ãŸã¯ãã®ä½¿ç”¨ã€ãã®ä»–ã®å–ã‚Šæ‰±ã„ã‹ã‚‰ç”Ÿã˜ã‚‹ã„ã‹ãªã‚‹è«‹æ±‚ã€æå®³ã€ãã®ä»–ã®è²¬ä»»ã«ã¤ã„ã¦ã‚‚ä¸€åˆ‡è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚
-->

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#FFB7C5" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="#FFB7C5" />
  <meta name="description" content="å„ªã—ã„ç”Ÿç†ãƒˆãƒ©ãƒƒã‚«ãƒ¼ã§ã‚ãªãŸã®ã‚µã‚¤ã‚¯ãƒ«ã‚’ã‚µãƒãƒ¼ãƒˆ" />
  <link rel="manifest" href="./manifest.json" />
  <link rel="apple-touch-icon" href="./icon-192.png" />
  <link rel="icon" type="image/png" href="alwin.png" />
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;600;700&display=swap" as="style" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;600;700&display=swap" rel="stylesheet" async />
  <title>ROSã‚µã‚¤ã‚¯ãƒ« â€” å„ªã—ã„ç”Ÿç†ãƒˆãƒ©ãƒƒã‚«ãƒ¼</title>
  <style>
    :root {
      --bg1: #FFF5F7; /* Sakura pink */
      --bg2: #F0FFF2; /* Matcha green */
      --pink: #FFB7C5; /* Softer sakura pink */
      --soft: #FFDDE1; /* Light cherry blossom */
      --mint: #A8D5BA; /* Matcha-inspired green */
      --text: #2E2E2E;
      --muted: #7A7A7A;
      --card: #FFFFFF;
      --shadow: 0 4px 16px rgba(0,0,0,0.1);
      --bg-dark: #2A2A2A;
      --card-dark: #3A3A3A;
      --text-dark: #F2F2F2;
      --muted-dark: #A0A0A0;
    }
    [data-theme="dark"] {
      --bg1: #2A2A2A;
      --bg2: #3A3A3A;
      --card: #3A3A3A;
      --text: #F2F2F2;
      --muted: #A0A0A0;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      font-family: 'Noto Sans JP', system-ui, -apple-system, Segoe UI, Roboto;
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--bg1), var(--bg2));
      color: var(--text);
      padding: 20px;
      overscroll-behavior: none;
    }
    .app {
      width: 100%;
      max-width: 760px;
      background: var(--card);
      border-radius: 20px;
      box-shadow: var(--shadow);
      padding: 24px;
      animation: fadeIn 0.5s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
    header {
      display: flex;
      align-items: center;
      gap: 16px;
      position: relative;
    }
    .logo {
      font-size: 30px;
      font-weight: 700;
      background: linear-gradient(45deg, var(--pink), var(--soft));
      -webkit-background-clip: text;
      color: transparent;
    }
    .lead {
      color: var(--muted);
      font-weight: 300;
      font-size: 14px;
    }
    .step-indicator {
      margin: 12px 0;
      font-size: 13px;
      color: var(--muted);
      text-align: center;
      letter-spacing: 1px;
    }
    main { margin-top: 16px; }
    .step {
      display: none;
      opacity: 0;
      transform: translateY(12px);
      transition: all 0.3s ease-in-out;
    }
    .step.active {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }
    .card {
      background: var(--card);
      border-radius: 14px;
      padding: 20px;
      box-shadow: 0 3px 12px rgba(0,0,0,0.06);
      transition: transform 0.2s ease;
    }
    .card:hover {
      transform: translateY(-2px);
    }
    .field {
      margin-bottom: 14px;
      text-align: left;
    }
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 6px;
      color: var(--text);
    }
    input[type="text"], input[type="date"], input[type="number"] {
      width: 100%;
      padding: 12px 14px;
      border-radius: 12px;
      border: 1.5px solid #FFE1E6;
      background: var(--card);
      outline: none;
      color: var(--text);
      font-size: 16px;
      -webkit-appearance: none;
      transition: all 0.2s ease;
    }
    input:focus {
      box-shadow: 0 0 10px rgba(255,183,197,0.3);
      border-color: var(--pink);
      transform: scale(1.02);
    }
    .controls {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 12px;
    }
    button {
      cursor: pointer;
      border: 0;
      padding: 10px 18px;
      border-radius: 12px;
      font-weight: 600;
      font-size: 15px;
      touch-action: manipulation;
      transition: all 0.2s ease;
    }
    .btn-primary {
      background: linear-gradient(45deg, var(--pink), var(--soft));
      color: white;
    }
    .btn-primary:hover {
      transform: scale(1.05);
      box-shadow: 0 0 8px rgba(255,183,197,0.5);
    }
    .btn-ghost {
      background: transparent;
      color: var(--text);
    }
    .btn-ghost:hover {
      background: rgba(255,183,197,0.1);
    }
    .month-nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 20px 0;
    }
    .month-title {
      font-weight: 700;
      font-size: 18px;
      color: var(--text);
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
    }
    .weekday-label {
      text-align: center;
      font-size: 12px;
      font-weight: 600;
      color: var(--muted);
      padding: 8px 0;
    }
    .cell {
      background: var(--card);
      border-radius: 10px;
      padding: 10px;
      min-height: 60px;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      flex-direction: column;
      border: 1px solid #F5F5F5;
      position: relative;
      touch-action: manipulation;
      transition: all 0.2s ease;
    }
    .cell:hover {
      transform: scale(1.03);
      box-shadow: 0 0 8px rgba(255,183,197,0.3);
    }
    .cell.other {
      background: #FAFAFA;
      color: #BBB;
    }
    .daynum { font-weight: 700; }
    .badge {
      position: absolute;
      right: 6px;
      top: 6px;
      font-size: 10px;
      padding: 4px 6px;
      border-radius: 8px;
      font-weight: 600;
    }
    .period {
      background: linear-gradient(45deg, var(--pink), #FFDDE1);
      color: #FFF;
    }
    .fertile {
      background: linear-gradient(45deg, var(--mint), #E6F5ED);
      color: var(--text);
    }
    .legend {
      display: flex;
      gap: 12px;
      margin-top: 12px;
      align-items: center;
    }
    .legend .box {
      width: 14px;
      height: 14px;
      border-radius: 4px;
    }
    .tooltip {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: var(--card);
      border-radius: 10px;
      padding: 8px 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.12);
      white-space: nowrap;
      font-size: 12px;
      color: var(--text);
      display: none;
      z-index: 10;
      max-width: 240px;
    }
    .cell:hover .tooltip, .cell:focus-within .tooltip { display: block; }
    @media (max-width: 768px) {
      header { flex-direction: column; padding: 12px 16px; }
      .tooltip {
        bottom: auto;
        top: 100%;
        transform: translateX(-50%);
        white-space: normal;
        max-width: 90vw;
      }
      .grid { gap: 5px; }
      .cell { min-height: 56px; }
      .app { padding: 16px; }
    }
    .modal {
      position: fixed;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 60;
      display: none;
      animation: fadeIn 0.3s ease;
    }
    .modal.active { display: flex; }
    .modal .box {
      background: var(--card);
      padding: 20px;
      border-radius: 14px;
      max-width: 440px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
      width: 90%;
      animation: popIn 0.3s ease;
    }
    @keyframes popIn {
      from { transform: scale(0.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    footer {
      margin-top: 16px;
      font-size: 12px;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }
    .theme-toggle {
      font-size: 12px;
      cursor: pointer;
      color: var(--pink);
      transition: color 0.2s ease;
    }
    .theme-toggle:hover {
      color: var(--soft);
    }
    .checkbox-field {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }
    .checkbox-field input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: var(--pink);
    }
    a.github-link, a.portfolio-link {
      color: var(--pink);
      text-decoration: none;
      font-weight: 600;
    }
    a.github-link:hover, a.portfolio-link:hover {
      text-decoration: underline;
      color: var(--soft);
    }
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="ROSã‚µã‚¤ã‚¯ãƒ«ãƒ»ãƒˆãƒ©ãƒƒã‚«ãƒ¼">
    <header>
      <div class="logo">ğŸŒ¸ ROSã‚µã‚¤ã‚¯ãƒ«</div>
      <div>
        <div class="lead">å„ªã—ãã¦ã€ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚’å®ˆã‚‹ã€å­¦ç”Ÿå‘ã‘ã‚¢ãƒ—ãƒª</div>
        <div style="font-size:12px;color:var(--muted)">ãƒ‡ãƒ¼ã‚¿ã¯ä¿å­˜ã•ã‚Œã¾ã›ã‚“ã€‚ã“ã®ãƒ‡ãƒ¢ã¯ãƒ­ãƒ¼ã‚«ãƒ«å°‚ç”¨ã§ã™ã€‚</div>
      </div>
    </header>

    <main aria-live="polite">
      <!-- ã‚¹ãƒ†ãƒƒãƒ—1: åŸºæœ¬æƒ…å ± -->
      <section class="step active" id="step-1">
        <div class="step-indicator">ã‚¹ãƒ†ãƒƒãƒ— 1 / 4</div>
        <div class="card">
          <h3 style="margin:0 0 8px">ã“ã‚“ã«ã¡ã¯ï¼ç°¡å˜ã§ã—ã‚‡ï¼Ÿâœ¨</h3>
          <p style="margin:0 0 12px;color:var(--muted)">ã„ãã¤ã‹å„ªã—ã„è³ªå•ã‚’ã™ã‚‹ã ã‘ã€‚ã„ã¤ã§ã‚‚æˆ»ã‚Œã¾ã™ã‚ˆï¼</p>
          <div class="field">
            <label for="name">ãŠåå‰</label>
            <input id="name" type="text" placeholder="ãªã‚“ã¦å‘¼ã¹ã°ã„ã„ï¼Ÿ" autocomplete="name" aria-label="ãŠåå‰" />
          </div>
          <div class="field">
            <label for="dob">ç”Ÿå¹´æœˆæ—¥ <span style="font-weight:400;color:var(--muted);font-size:13px">ï¼ˆå¹´é½¢ç¢ºèªç”¨ã®ã¿ï¼‰</span></label>
            <input id="dob" type="date" aria-label="ç”Ÿå¹´æœˆæ—¥" />
            <div style="font-size:12px;color:var(--muted);margin-top:6px">å¹´é½¢ã‚’å…¥åŠ›ã—ã¦ã‚‚å¤§ä¸ˆå¤«ã ã‚ˆï¼</div>
          </div>
          <div class="controls" style="justify-content: space-between;">
            <button class="btn-ghost" onclick="skipInfo()">ã‚¹ã‚­ãƒƒãƒ—</button>
            <div>
              <button class="btn-primary" onclick="nextToPCOD()" style="margin-right: 10px;">PCOSãƒã‚§ãƒƒã‚¯</button>
              <button class="btn-primary" onclick="nextToStep2()" id="step1-next">æ¬¡ã¸</button>
            </div>
          </div>
        </div>
      </section>

      <!-- ã‚¹ãƒ†ãƒƒãƒ—2: PCOSç—‡çŠ¶ãƒã‚§ãƒƒã‚¯ -->
      <section class="step" id="step-pcod">
        <div class="step-indicator">ã‚¹ãƒ†ãƒƒãƒ— 2 / 4</div>
        <div class="card">
          <h3 style="margin:0 0 8px">å¤šåš¢èƒæ€§åµå·£ç—‡å€™ç¾¤ï¼ˆPCOSï¼‰ã®ç—‡çŠ¶ãƒã‚§ãƒƒã‚¯</h3>
          <p style="margin:0 0 12px;color:var(--muted)">ä¸€èˆ¬çš„ãªç—‡çŠ¶ã«ã¤ã„ã¦ç­”ãˆã¦ã­ã€‚ã“ã‚Œã¯åŒ»ç™‚è¨ºæ–­ã§ã¯ãªã„ã®ã§ã€ãŠåŒ»è€…ã•ã‚“ã«ç›¸è«‡ã—ã¦ãã ã•ã„ã­ã€‚</p>
          <form id="pcod-form" role="form" aria-label="PCOSç—‡çŠ¶ãƒã‚§ãƒƒã‚¯">
            <div class="checkbox-field">
              <input type="checkbox" id="symptom1" aria-label="ç”Ÿç†ãŒä¸è¦å‰‡ã¾ãŸã¯æ¥ãªã„" />
              <label for="symptom1">ç”Ÿç†ãŒä¸è¦å‰‡ã¾ãŸã¯æ¥ãªã„</label>
            </div>
            <div class="checkbox-field">
              <input type="checkbox" id="symptom2" aria-label="é¡”ã‚„ä½“ã®æ¯›ãŒæ¿ƒã„" />
              <label for="symptom2">é¡”ã‚„ä½“ã®æ¯›ãŒæ¿ƒã„</label>
            </div>
            <div class="checkbox-field">
              <input type="checkbox" id="symptom3" aria-label="ãƒ‹ã‚­ãƒ“ã‚„è„‚æ€§è‚Œ" />
              <label for="symptom3">ãƒ‹ã‚­ãƒ“ã‚„è„‚æ€§è‚Œ</label>
            </div>
            <div class="checkbox-field">
              <input type="checkbox" id="symptom4" aria-label="å¦Šå¨ ã—ã«ãã„" />
              <label for="symptom4">å¦Šå¨ ã—ã«ãã„</label>
            </div>
            <div class="checkbox-field">
              <input type="checkbox" id="symptom5" aria-label="ä½“é‡å¢—åŠ ã‚„ç—©ã›ã«ãã„" />
              <label for="symptom5">ä½“é‡å¢—åŠ ã‚„ç—©ã›ã«ãã„</label>
            </div>
            <div class="checkbox-field">
              <input type="checkbox" id="symptom6" aria-label="é ­é«ªãŒè–„ããªã‚‹" />
              <label for="symptom6">é ­é«ªãŒè–„ããªã‚‹</label>
            </div>
            <div class="checkbox-field">
              <input type="checkbox" id="symptom7" aria-label="çš®è†šã®é»’ãšã¿" />
              <label for="symptom7">çš®è†šã®é»’ãšã¿ï¼ˆä¾‹ï¼šé¦–ã€è‚¡é–“ï¼‰</label>
            </div>
            <div class="checkbox-field">
              <input type="checkbox" id="symptom8" aria-label="çš®è†šã®ã‚¿ã‚°" />
              <label for="symptom8">çš®è†šã®ã‚¿ã‚°</label>
            </div>
            <div class="checkbox-field">
              <input type="checkbox" id="symptom9" aria-label="éª¨ç›¤ã®ç—›ã¿" />
              <label for="symptom9">éª¨ç›¤ã®ç—›ã¿</label>
            </div>
            <div class="checkbox-field">
              <input type="checkbox" id="symptom10" aria-label="ç–²ã‚Œã‚„ã™ã•ã‚„ä½ã‚¨ãƒãƒ«ã‚®ãƒ¼" />
              <label for="symptom10">ç–²ã‚Œã‚„ã™ã•ã‚„ä½ã‚¨ãƒãƒ«ã‚®ãƒ¼</label>
            </div>
            <div class="controls">
              <button class="btn-ghost" onclick="showStep(1)">â† æˆ»ã‚‹</button>
              <button class="btn-primary" type="button" onclick="checkPCOD()">é€ä¿¡</button>
            </div>
          </form>
        </div>
      </section>

      <!-- ã‚¹ãƒ†ãƒƒãƒ—3: ç”Ÿç†ã®è©³ç´° -->
      <section class="step" id="step-2">
        <div class="step-indicator">ã‚¹ãƒ†ãƒƒãƒ— 3 / 4</div>
        <div class="card">
          <h3 style="margin:0 0 8px">ç”Ÿç†ã®è©³ç´°</h3>
          <p style="margin:0 0 12px;color:var(--muted)">ã‚ã¨ä¸€æ­©ï¼ã“ã‚Œã§å„ªã—ã„äºˆæ¸¬ã‚’ä½œã‚Šã¾ã™ã‚ˆã€‚</p>
          <div class="field">
            <label for="last">æœ€å¾Œã®ç”Ÿç†ã¯ã„ã¤å§‹ã¾ã£ãŸï¼Ÿ</label>
            <input id="last" type="date" aria-label="æœ€å¾Œã®ç”Ÿç†é–‹å§‹æ—¥" />
          </div>
          <div class="field">
            <label for="cycle">å¹³å‡ã‚µã‚¤ã‚¯ãƒ«æ—¥æ•°</label>
            <input id="cycle" type="number" min="15" max="45" value="28" aria-label="ã‚µã‚¤ã‚¯ãƒ«æ—¥æ•°" />
          </div>
          <div class="field">
            <label for="periodLen">å¹³å‡ç”Ÿç†æœŸé–“ï¼ˆæ—¥æ•°ï¼‰</label>
            <input id="periodLen" type="number" min="3" max="10" value="5" aria-label="ç”Ÿç†æœŸé–“" />
          </div>
          <div class="controls">
            <button class="btn-ghost" onclick="showStep('pcod')">â† æˆ»ã‚‹</button>
            <button class="btn-primary" onclick="createCalendar()">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’ä½œã‚‹</button>
          </div>
        </div>
      </section>

      <!-- ã‚¹ãƒ†ãƒƒãƒ—4: ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->
      <section class="step" id="step-3">
        <div class="step-indicator">ã‚¹ãƒ†ãƒƒãƒ— 4 / 4</div>
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px">
            <div>
              <div id="greeting" style="font-weight:700"></div>
              <div style="font-size:13px;color:var(--muted)" id="age-note"></div>
            </div>
            <div style="text-align:right">
              <div style="font-size:12px;color:var(--muted)">äºˆæ¸¬æœˆæ•°: <span id="pred-count">0</span></div>
              <div style="font-size:12px;color:var(--muted)">è¡¨ç¤ºä¸­: <span id="visible-month"></span></div>
            </div>
          </div>
          <div class="month-nav">
            <button class="btn-ghost" aria-label="å‰ã®æœˆ" id="prevBtn">â†</button>
            <div class="month-title" id="monthTitle">æœˆ</div>
            <button class="btn-ghost" aria-label="æ¬¡ã®æœˆ" id="nextBtn">â†’</button>
          </div>
          <div class="grid" id="weekdayLabels" style="grid-template-columns: repeat(7, 1fr);">
            <div class="weekday-label">æ—¥</div>
            <div class="weekday-label">æœˆ</div>
            <div class="weekday-label">ç«</div>
            <div class="weekday-label">æ°´</div>
            <div class="weekday-label">æœ¨</div>
            <div class="weekday-label">é‡‘</div>
            <div class="weekday-label">åœŸ</div>
          </div>
          <div class="grid" id="calendarGrid" role="grid" aria-label="ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚°ãƒªãƒƒãƒ‰"></div>
          <div class="legend">
            <div style="display:flex;align-items:center;gap:8px"><div class="box period"></div> ç”Ÿç†</div>
            <div style="display:flex;align-items:center;gap:8px"><div class="box fertile"></div> æ’åµæ—¥</div>
          </div>
          <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
            <button class="btn-ghost" onclick="showStep(2)">æ›´æ–°</button>
            <button class="btn-primary" onclick="showResetModal()">æœ€åˆã‹ã‚‰</button>
          </div>
        </div>
        <p style="margin-top:8px;font-size:12px;color:var(--muted)">âš ï¸ ã“ã‚Œã¯å­¦ç”ŸãŒä½œã£ãŸæ•™è‚²ç›®çš„ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã§ã™ã€‚äºˆæ¸¬ã¯å¹³å‡çš„ãªã‚µã‚¤ã‚¯ãƒ«ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ãæ¨å®šã§ã‚ã‚Šã€é£Ÿäº‹ã€ã‚¹ãƒˆãƒ¬ã‚¹ã€ãƒ›ãƒ«ãƒ¢ãƒ³ã®å¤‰åŒ–ãªã©ã§å¤‰å‹•ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚åŒ»ç™‚æ‰¿èªã¯ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚<a href="https://github.com/alwin-m/ROS-Cycle-Project" class="github-link" target="_blank" rel="noopener" aria-label="ROSã‚µã‚¤ã‚¯ãƒ«ã«GitHubã§è²¢çŒ®">GitHubã§è²¢çŒ®</a>ã—ã¦ã€ç²¾åº¦ã‚’å‘ä¸Šã•ã›ã¾ã—ã‚‡ã†ï¼</p>
      </section>
    </main>

    <footer>
      <div style="font-size:12px;color:var(--muted)">
        ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ â€¢ MITãƒ©ã‚¤ã‚»ãƒ³ã‚¹ â€¢ <a href="https://github.com/alwin-m/ROS-Cycle-Project" class="github-link" target="_blank" rel="noopener" aria-label="ROSã‚µã‚¤ã‚¯ãƒ«ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã‚’è¨ªå•">GitHub</a> â€¢ <a href="https://alwin-m.github.io/Portfolio/" class="portfolio-link" target="_blank" rel="noopener" aria-label="Alwin Madhuã®ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã‚’è¨ªå•">ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ª</a>
      </div>
      <div style="display:flex;gap:12px">
        <div class="theme-toggle" onclick="toggleTheme()">ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã‚’åˆ‡ã‚Šæ›¿ãˆ</div>
        <div style="font-size:12px;color:var(--muted)">å­¦ç”Ÿã®ãŸã‚ã« â€¢ ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚’ç¬¬ä¸€ã«</div>
      </div>
    </footer>
  </div>

  <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆè­¦å‘Š/è©³ç´°ï¼‰ -->
  <div class="modal" id="modal" role="dialog" aria-modal="true" aria-labelledby="modalText">
    <div class="box">
      <div id="modalText" role="alert"></div>
      <div style="text-align:right;margin-top:12px;display:flex;gap:10px;justify-content:flex-end">
        <button class="btn-ghost" onclick="closeModal()">OK</button>
        <button class="btn-primary" onclick="closeModal()">ç”Ÿç†ã‚’ç¢ºèª</button>
      </div>
    </div>
  </div>

  <!-- ãƒªã‚»ãƒƒãƒˆç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="modal" id="resetModal" role="dialog" aria-modal="true" aria-labelledby="resetModalText">
    <div class="box">
      <div id="resetModalText">æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã—ã¾ã™ã‹ï¼Ÿç¾åœ¨ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒã‚¯ãƒªã‚¢ã•ã‚Œã¾ã™ã€‚</div>
      <div style="text-align:right;margin-top:12px">
        <button class="btn-ghost" onclick="closeModal('resetModal')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button class="btn-primary" onclick="resetAll()">ç¢ºèª</button>
      </div>
    </div>
  </div>

  <script>
    let state = {
      name: '',
      dob: null,
      age: null,
      last: null,
      cycle: 28,
      periodLen: 5,
      months: [],
      visibleIndex: 0,
      pcodChance: null,
      pcodSymptoms: []
    };

    const el = id => document.getElementById(id);

    function formatDate(date) {
      return new Intl.DateTimeFormat('ja-JP', { year: 'numeric', month: 'long', day: 'numeric' }).format(date);
    }

    function showStep(n) {
      document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
      if (typeof n === 'string') {
        el('step-' + n).classList.add('active');
      } else {
        el('step-' + n).classList.add('active');
      }
      const firstInput = typeof n === 'string' ? el('step-' + n).querySelector('input, button') : el('step-' + n).querySelector('input, button');
      if (firstInput) firstInput.focus();
    }

    function showModal(msg) {
      el('modalText').innerHTML = msg.replace(/\n\n/g, '<br><br>').replace(/https:\/\/github\.com\/alwin-m\/ROS-Cycle-Project/g, '<a href="https://github.com/alwin-m/ROS-Cycle-Project" class="github-link" target="_blank" rel="noopener" aria-label="ROSã‚µã‚¤ã‚¯ãƒ«ã«GitHubã§è²¢çŒ®">GitHub</a>');
      el('modal').classList.add('active');
      el('modal').querySelector('.btn-ghost').focus();
    }

    function closeModal(id = 'modal') {
      el(id).classList.remove('active');
      if (id === 'modal' && document.querySelector('#step-pcod.active')) {
        showStep(2);
      }
    }

    function showResetModal() {
      el('resetModal').classList.add('active');
      el('resetModal').querySelector('button').focus();
    }

    function resetAll() {
      state = {
        name: '',
        dob: null,
        age: null,
        last: null,
        cycle: 28,
        periodLen: 5,
        months: [],
        visibleIndex: 0,
        pcodChance: null,
        pcodSymptoms: []
      };
      el('name').value = '';
      el('dob').value = '';
      el('last').value = '';
      el('cycle').value = '28';
      el('periodLen').value = '5';
      el('calendarGrid').innerHTML = '';
      el('monthTitle').innerText = 'æœˆ';
      el('pcod-form').reset();
      closeModal('resetModal');
      showStep(1);
    }

    function skipInfo() {
      state.name = '';
      state.dob = null;
      state.age = null;
      showStep(2);
    }

    function nextToStep2() {
      const name = el('name').value.trim();
      const dob = el('dob').value;
      if (name === '') return showModal('ãŠåå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã­ã€‚ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã§ã‚‚å¤§ä¸ˆå¤«ï¼');
      state.name = name;
      if (dob) {
        const parsed = new Date(dob);
        if (isNaN(parsed)) return showModal('ç”Ÿå¹´æœˆæ—¥ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚YYYY-MM-DDå½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã­ã€‚');
        const age = calculateAge(parsed);
        if (age < 9 || age > 55) {
          return showModal(`å¹´é½¢ãŒ${age}æ­³ã®ã‚ˆã†ã§ã™ã€‚é€šå¸¸ã®ç¯„å›²ï¼ˆ9ï½55æ­³ï¼‰å¤–ã§ã™ã€‚æ­£ã—ã‘ã‚Œã°ç¶šã‘ã¦ã€ãã†ã§ãªã‘ã‚Œã°å…¥åŠ›ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã­ï¼`);
        }
        state.dob = parsed;
        state.age = age;
      }
      showStep(2);
      setTimeout(() => el('last').focus(), 200);
    }

    function nextToPCOD() {
      const name = el('name').value.trim();
      const dob = el('dob').value;
      if (name === '') return showModal('ãŠåå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã­ã€‚ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã§ã‚‚å¤§ä¸ˆå¤«ï¼');
      state.name = name;
      if (dob) {
        const parsed = new Date(dob);
        if (isNaN(parsed)) return showModal('ç”Ÿå¹´æœˆæ—¥ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚YYYY-MM-DDå½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã­ã€‚');
        const age = calculateAge(parsed);
        if (age < 9 || age > 55) {
          return showModal(`å¹´é½¢ãŒ${age}æ­³ã®ã‚ˆã†ã§ã™ã€‚é€šå¸¸ã®ç¯„å›²ï¼ˆ9ï½55æ­³ï¼‰å¤–ã§ã™ã€‚æ­£ã—ã‘ã‚Œã°ç¶šã‘ã¦ã€ãã†ã§ãªã‘ã‚Œã°å…¥åŠ›ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã­ï¼`);
        }
        state.dob = parsed;
        state.age = age;
      }
      showStep('pcod');
      setTimeout(() => el('symptom1').focus(), 200);
    }

    function checkPCOD() {
      const symptoms = document.querySelectorAll('#pcod-form input[type="checkbox"]:checked');
      state.pcodSymptoms = Array.from(symptoms).map(s => s.nextElementSibling.textContent);
      const count = symptoms.length;
      let chance = 'low';
      let message = '';
      if (count <= 2) {
        chance = 'ä½';
        message = `å›ç­”ã«åŸºã¥ãã¨ã€å¤šåš¢èƒæ€§åµå·£ç—‡å€™ç¾¤ï¼ˆPCOSï¼‰ã®å¯èƒ½æ€§ã¯ä½ã„ã§ã™ã€‚`;
      } else if (count <= 5) {
        chance = 'ä¸­';
        message = `å›ç­”ã«åŸºã¥ãã¨ã€å¤šåš¢èƒæ€§åµå·£ç—‡å€™ç¾¤ï¼ˆPCOSï¼‰ã®å¯èƒ½æ€§ã¯ä¸­ç¨‹åº¦ã§ã™ã€‚ãŠåŒ»è€…ã•ã‚“ã«ç›¸è«‡ã™ã‚‹ã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚`;
      } else {
        chance = 'é«˜';
        message = `å›ç­”ã«åŸºã¥ãã¨ã€å¤šåš¢èƒæ€§åµå·£ç—‡å€™ç¾¤ï¼ˆPCOSï¼‰ã®å¯èƒ½æ€§ãŒé«˜ã„ã§ã™ã€‚æ­£ç¢ºãªè¨ºæ–­ã®ãŸã‚ã€ãœã²ãŠåŒ»è€…ã•ã‚“ã«ç›¸è«‡ã—ã¦ãã ã•ã„ã­ã€‚\n\nâš ï¸ æ³¨æ„ï¼šPCOSã¯ç”Ÿç†å‘¨æœŸã®ä¸è¦å‰‡ã‚’å¼•ãèµ·ã“ã™å¯èƒ½æ€§ãŒã‚ã‚Šã€ã“ã®ã‚¢ãƒ—ãƒªã®äºˆæ¸¬ç²¾åº¦ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚äºˆæ¸¬ã¯å¹³å‡çš„ãªã‚µã‚¤ã‚¯ãƒ«ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ãæ¨å®šã§ã‚ã‚Šã€é£Ÿäº‹ã€ã‚¹ãƒˆãƒ¬ã‚¹ã€ãƒ›ãƒ«ãƒ¢ãƒ³ã®å¤‰åŒ–ãªã©ã§å¤‰å‹•ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã§ã€ç²¾åº¦å‘ä¸Šã«å–ã‚Šçµ„ã‚“ã§ã„ã¾ã™ã€‚<a href="https://github.com/alwin-m/ROS-Cycle-Project" class="github-link" target="_blank" rel="noopener" aria-label="ROSã‚µã‚¤ã‚¯ãƒ«ã«GitHubã§è²¢çŒ®">GitHub</a>ã§è²¢çŒ®ã—ã¦ã€AIé§†å‹•ã®äºˆæ¸¬ãªã©æ©Ÿèƒ½ã‚’æ”¹å–„ã—ã¾ã—ã‚‡ã†ï¼`;
      }
      if (state.pcodSymptoms.length > 0) {
        message += `<br><br><strong>é¸æŠã—ãŸç—‡çŠ¶ï¼š</strong><ul style="margin:10px 0;padding-left:20px;">${state.pcodSymptoms.map(s => `<li>${s}</li>`).join('')}</ul>`;
      } else {
        message += `<br><br>ç—‡çŠ¶ã¯é¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚`;
      }
      message += `<br>ã“ã‚Œã¯åŒ»ç™‚è¨ºæ–­ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚å¿…ãšåŒ»ç™‚å°‚é–€å®¶ã«ç›¸è«‡ã—ã¦ãã ã•ã„ã­ã€‚`;
      state.pcodChance = chance;
      showModal(message);
    }

    function calculateAge(dob) {
      const diff = Date.now() - dob.getTime();
      return Math.floor(diff / (1000 * 60 * 60 * 24 * 365.25));
    }

    function createCalendar() {
      const lastVal = el('last').value;
      const cycleVal = parseInt(el('cycle').value, 10);
      const periodLenVal = parseInt(el('periodLen').value, 10);
      if (!lastVal) return showModal('æœ€å¾Œã®ç”Ÿç†é–‹å§‹æ—¥ã‚’é¸ã‚“ã§ãã ã•ã„ã­ã€‚');
      if (isNaN(cycleVal) || cycleVal < 15 || cycleVal > 45) {
        return showModal('ã‚µã‚¤ã‚¯ãƒ«æ—¥æ•°ã¯15ï½45æ—¥ã®é–“ã§ãŠé¡˜ã„ã—ã¾ã™ã€‚ç¯„å›²å¤–ã®å ´åˆã¯ã€åŒ»ç™‚å°‚é–€å®¶ã«ç›¸è«‡ã—ã¦ãã ã•ã„ã­ã€‚');
      }
      if (isNaN(periodLenVal) || periodLenVal < 3 || periodLenVal > 10) {
        return showModal('ç”Ÿç†æœŸé–“ã¯3ï½10æ—¥ã®é–“ã§ãŠé¡˜ã„ã—ã¾ã™ã€‚');
      }
      const last = new Date(lastVal);
      if (isNaN(last)) return showModal('ç”Ÿç†é–‹å§‹æ—¥ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚YYYY-MM-DDå½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã­ã€‚');
      if (last > new Date()) return showModal('æœ€å¾Œã®ç”Ÿç†é–‹å§‹æ—¥ã¯æœªæ¥ã®æ—¥ä»˜ã«ã§ãã¾ã›ã‚“ã€‚');
      state.last = new Date(last.getFullYear(), last.getMonth(), last.getDate());
      state.cycle = cycleVal;
      state.periodLen = periodLenVal;
      state.months = [];
      state.visibleIndex = 0;
      generateMonth(state.visibleIndex);
      renderMonth(state.visibleIndex);
      showStep(3);
    }

    function generateMonth(index) {
      if (state.months[index]) return;
      const start = new Date(state.last.getFullYear(), state.last.getMonth(), 1);
      const oneDay = 24 * 60 * 60 * 1000;
      const mm = new Date(start.getFullYear(), start.getMonth() + index, 1);
      const days = new Date(mm.getFullYear(), mm.getMonth() + 1, 0).getDate();
      const monthObj = { month: mm.getMonth(), year: mm.getFullYear(), days: [] };
      for (let d = 1; d <= days; d++) {
        const date = new Date(mm.getFullYear(), mm.getMonth(), d);
        const diffDays = Math.round((date - state.last) / oneDay);
        let type = 'normal';
        if (diffDays >= 0) {
          const mod = Math.abs(diffDays % state.cycle);
          if (mod < state.periodLen) type = 'period';
          const ovulationIndex = state.cycle - 14;
          const fertileStart = ovulationIndex - 5;
          if (mod >= fertileStart && mod <= ovulationIndex) type = (type === 'period') ? 'period' : 'fertile';
        }
        monthObj.days.push({ date, type });
      }
      state.months[index] = monthObj;
    }

    function renderMonth(index) {
      if (index < 0 || index >= 12) return showModal('ã“ã®æœˆã®äºˆæ¸¬ã¯ã§ãã¾ã›ã‚“ã€‚12ãƒ¶æœˆã®ã¿äºˆæ¸¬ã—ã¾ã™ã€‚');
      generateMonth(index);
      const monthObj = state.months[index];
      el('monthTitle').innerText = `${getMonthName(monthObj.month)} ${monthObj.year}`;
      el('pred-count').innerText = 12;
      el('visible-month').innerText = `${index + 1}/12`;
      el('greeting').innerText = `ã“ã‚“ã«ã¡ã¯ã€${state.name || 'ã‚ãªãŸ'}ã¡ã‚ƒã‚“ï¼ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã ã‚ˆï¼š`;
      el('age-note').innerText = state.age ? `å¹´é½¢ï¼š${state.age}æ­³${state.pcodChance ? `ã€PCOSå¯èƒ½æ€§ï¼š${state.pcodChance}` : ''}` : state.pcodChance ? `PCOSå¯èƒ½æ€§ï¼š${state.pcodChance}` : '';
      const grid = el('calendarGrid');
      grid.innerHTML = '';
      const firstDay = new Date(monthObj.year, monthObj.month, 1);
      const startOffset = firstDay.getDay();
      const daysInMonth = monthObj.days.length;
      const totalCells = Math.ceil((startOffset + daysInMonth) / 7) * 7;
      for (let i = 0; i < totalCells; i++) {
        const cell = document.createElement('div');
        cell.className = 'cell';
        if (i < startOffset || i >= startOffset + daysInMonth) {
          cell.className += ' other';
          cell.innerHTML = `<div class="daynum">-</div>`;
        } else {
          const dayIndex = i - startOffset;
          const day = monthObj.days[dayIndex];
          const dateStr = formatDate(day.date);
          cell.innerHTML = `<div class="daynum">${day.date.getDate()}</div>`;
          if (day.type !== 'normal') {
            cell.innerHTML += `<div class="badge ${day.type}">${day.type === 'period' ? 'ç”Ÿç†' : 'æ’åµæ—¥'}</div>`;
            const tip = document.createElement('div');
            tip.className = 'tooltip';
            tip.innerText = `${day.type === 'period' ? 'ç”Ÿç†ã®æ—¥' : 'æ’åµæ—¥'}: ${dateStr}`;
            cell.appendChild(tip);
          }
        }
        cell.tabIndex = 0;
        grid.appendChild(cell);
      }
    }

    function getMonthName(month) {
      const names = ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ'];
      return names[month];
    }

    function toggleTheme() {
      const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
      document.documentElement.setAttribute('data-theme', isDark ? 'light' : 'dark');
      localStorage.setItem('theme', isDark ? 'light' : 'dark');
    }

    el('prevBtn').addEventListener('click', () => {
      state.visibleIndex = Math.max(0, state.visibleIndex - 1);
      renderMonth(state.visibleIndex);
    });

    el('nextBtn').addEventListener('click', () => {
      state.visibleIndex = Math.min(11, state.visibleIndex + 1);
      renderMonth(state.visibleIndex);
    });

    function setMaxDates() {
      const today = new Date().toISOString().split('T')[0];
      el('dob').max = today;
      el('last').max = today;
    }

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && el('modal').classList.contains('active')) {
        closeModal();
      } else if (e.key === 'Escape' && el('resetModal').classList.contains('active')) {
        closeModal('resetModal');
      }
    });

    (function init() {
      const savedTheme = localStorage.getItem('theme') || 'light';
      document.documentElement.setAttribute('data-theme', savedTheme);
      setMaxDates();
      el('name').focus();
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('serviceworker.js')
          .then(() => console.log('ã‚µãƒ¼ãƒ“ã‚¹ãƒ¯ãƒ¼ã‚«ãƒ¼ãŒæ­£å¸¸ã«ç™»éŒ²ã•ã‚Œã¾ã—ãŸ'))
          .catch(err => console.warn('ã‚µãƒ¼ãƒ“ã‚¹ãƒ¯ãƒ¼ã‚«ãƒ¼ã®ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ:', err.message));
      } else {
        console.warn('ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯ã‚µãƒ¼ãƒ“ã‚¹ãƒ¯ãƒ¼ã‚«ãƒ¼ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
      }
    })();
  </script>
</body>
</html>
